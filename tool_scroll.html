
<!DOCTYPE html>
<html lang="en">
<head>
<title>Navigate your text</title>

<meta name="keywords" content="" />
<meta name="description" content = "" />
<meta name="viewport" content="width=device-width" />
<meta name="renderer" content="webkit" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />

<link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" />

<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/bootstrap.js"></script>
<script type="text/javascript" src="js/jquery.mousewheel.js"></script>

<style>
  p.highlight {
    font-weight: bold;
    color: red;
  }
</style>

<script type="text/javascript">
  var cnt;
  var paras;
  var curIdx;

  $(document).ready( function() { 
    curIdx = 0;
    cnt = $('#content-text').children('p').length;
    paras = $('#content-text').children('p');

    $(window).bind('keydown', function(e) {
      //window.alert(e.keyCode);
      if (e.keyCode == 83 /* s */) {
        readText(0);
        startTracking();
      }
      if (e.keyCode == 69 /* e */) {
        $(window).off('mousewheel');
        window.speechSynthesis.cancel();
      }
    });

    $('#btn-content').click(function() {
      cnt = $('#content-text').children('p').length;
      paras = $('#content-text').children('p');

      var text = $('#textarea-content').val();
      text = text.replace(/\n\r?/g, '<br />'); 
      $('#content-text').html(text);
      $('#content-text')
        .contents()
          .filter(function() {
            return this.nodeType === 3;
          })
            .wrap( "<p></p>" )
            .end()
          .filter( "br" )
          .remove();
      });

  });

  var startTracking = function() {
    $(window).mousewheel(function(e) {
      console.log(e.deltaY);

      if (curIdx + e.deltaY > cnt - 1) curIdx = cnt - 1;
      else if (curIdx + e.deltaY < 0) curIdx = 0;
      else curIdx += e.deltaY;
      readText(curIdx);
    });

    $(window).bind('keydown', function(e) {
      if (e.keyCode == 40 /* down */) {
        curIdx += 1;
        readText(curIdx);
      }
      if (e.keyCode == 38 /* up */) {
        curIdx -= 1;
        readText(curIdx);
      }
    });
  };

  var readText = function(index) {

    if (index < 0) {curIdx = 0; return;}
    else if (index > cnt-1) {curIdx = cnt-1; return;}

    window.speechSynthesis.cancel();

    var curText = $(paras[index]);

    var msg = new SpeechSynthesisUtterance();
    //var voices = window.speechSynthesis.getVoices();
    //msg.voice = voices[10]; // Note: some voices don't support altering params
    msg.voiceURI = 'native';
    msg.volume = 1; // 0 to 1
    msg.rate = 1.3; // 0.1 to 10
    msg.pitch = 1; //0 to 2
    msg.text = curText.text();
    msg.lang = 'en-US';
    
    msg.onstart = function(e) {
      curText.addClass('highlight');
      $('#direction-y').text(curIdx);
    }
    
    msg.onend = function(e) {
      curText.removeClass('highlight');
    };

    window.speechSynthesis.speak(msg);
  }

</script>

</head>
<body>

<div class="container-fluid">
  <div class="row">
    <div class="col-md-8">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title">Content</h3>
        </div>

        <div class="panel-body">
          <div id="content-text">
            <p>
              TEST PARAGRAPH
            </p>
            <p>
              Hey Jude, don't make it bad
            </p>
            <p>
              Take a sad song and make it better
            </p>
            <p>
              Remember to let her into your heart
            </p>
            <p>
              Then you can start to make it better
            </p>
            <p>
              Hey Jude, don't be afraid
            </p>
            <p>
              You were made to go out and get her
            </p>
            <p>
              The minute you let her under your skin
            </p>
            <p>
              Then you begin to make it better
            </p>
            <p>
              And anytime you feel the pain, hey Jude, refrain
            </p>
            <p>
              Don't carry the world upon your shoulders
            </p>
            <p>
              For well you know that it's a fool who plays it cool
            </p>
            <p>
              By making his world a little colder
            </p>
            <p>
              Nah nah nah nah nah nah nah nah nah
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Instruction</h3>
          </div>

        <div class="panel-body">
          <div>
            <textarea id="textarea-content" type="text" class="form-control"></textarea>
            <button id="btn-content" class="btn btn-default" type="button" style="margin-top: 10px; margin-bottom: 10px;">Display</button>
          </div>
          <div id="coord">
            <span id="direction-y" class="label label-info"></span>
          </div>
          After displaying the text, press <span class="label label-warning">s</span> to start and press <span class="label label-warning">e</span> to end. Move mouse horizontally to navigate.
        </div>
      </div>
    </div>

  </div>
</div>

</body>
</html>
